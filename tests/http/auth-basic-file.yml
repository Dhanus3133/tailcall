config: !file tests/http/config/auth-basic-file.graphql
name: Auth with BasicAuth loaded from file
assert:
  - request:
      method: POST
      url: http://localhost:8080/graphql
      body:
        query: |
          query {
            scalar
            nested {
              name
            }
          }
    response:
      body:
        data:
          scalar: data from public scalar
          nested:
            name: protected nested name

  - request:
      method: POST
      url: http://localhost:8080/graphql
      body:
        query: |
          query {
            protectedScalar
          }
    response:
      body:
        data: null
        errors:
          - message: Haven't found auth parameters
            locations:
              - column: 3
                line: 2

  - request:
      method: POST
      url: http://localhost:8080/graphql
      headers:
        Authorization: Basic dGVzdHVzZXIxOnJhbmRvbV9wYXNzd29yZA== # wrong password
      body:
        query: |
          query {
            protectedScalar
          }
    response:
      body:
        data: null
        errors:
          - message: Auth validation failed
            locations:
              - column: 3
                line: 2

  - request:
      method: POST
      url: http://localhost:8080/graphql
      headers:
        Authorization: Basic dGVzdHVzZXIyOm15cGFzc3dvcmQ=
      body:
        query: |
          query {
            protectedScalar
            nested {
              name
              protected
            }
            protectedType {
              name
              nested
            }
          }
    response:
      body:
        data:
          protectedScalar: data from protected scalar
          nested:
            name: protected nested name
            protected: protected nested
          protectedType:
            name: protected type name
            nested: protected type nested
